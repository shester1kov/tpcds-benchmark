# Implementation Tasks: Интеграция S3-загрузки в бенчмарк

> Работай через фазы **по порядку**. Каждая следующая строится на предыдущей.

## Перед началом

- [ ] Прочитай и понял spec.md
- [ ] Прочитал и понял design.md
- [ ] Запусти `/own:advise` для подготовки
- [ ] Спроси ментора если что-то непонятно

---

## Фаза 1: BenchmarkRunner — добавить зависимость S3
> Изменяем структуру и конструктор. Никакой логики загрузки пока нет.

- [ ] Добавить поле `s3 *storage.S3Storage` в структуру `BenchmarkRunner`
- [ ] Добавить параметр `s3 *storage.S3Storage` в `NewBenchmarkRunner`
  └── Зависит от: поле добавлено
- [ ] Сохранить `s3` в поле структуры внутри конструктора
  └── Зависит от: параметр добавлен
- [ ] Убедиться что код компилируется (`go build ./...`)

**Чекпоинт:** `go build` проходит без ошибок. Runner принимает S3 как параметр.

---

## Фаза 2: Логика загрузки в Run()
> Добавляем upload после завершения бенчмарка.

- [ ] Убрать `defer br.storage.Close()` или оставить — обоснуй своё решение ментору
  └── Подсказка: смотри design.md раздел "Поток данных"
- [ ] Добавить явный вызов `br.storage.Close()` в нужном месте `Run()`
  └── Зависит от: понять где именно (после всех тестов)
- [ ] Добавить условный вызов upload: `if br.s3 != nil { ... }`
  └── Зависит от: явный Close() добавлен
- [ ] Реализовать логирование успеха и ошибки upload
  └── Зависит от: условный вызов добавлен
- [ ] Убедиться что ошибка upload не возвращается из `Run()` — только логируется

**Чекпоинт:** `go build` проходит. Логика корректна по design.md.

---

## Фаза 3: Создание S3Storage в main
> Точка входа решает — создавать S3 или нет.

- [ ] Найти место в `main.go` где создаётся `BenchmarkRunner`
- [ ] Перед созданием runner — добавить блок: если `cfg.S3Config.Enabled` → создать `S3Storage`
  └── Иначе: переменная равна `nil`
- [ ] Обработать ошибку `NewS3Storage` в main — это фатальная ошибка
- [ ] Передать `s3` (или `nil`) в `NewBenchmarkRunner`
  └── Зависит от: сигнатура конструктора обновлена в Фазе 1
- [ ] `go build ./...` — финальная сборка

**Чекпоинт:** Программа собирается. При `enabled: false` — upload не вызывается.

---

## Фаза 4: Тестирование
> Проверяем на реальном Ozone S3 endpoint.

- [ ] Настроить `config.yaml` с реальными credentials и `enabled: true`
- [ ] Запустить бенчмарк, убедиться что файл появился в бакете
- [ ] Проверить лог-сообщения: видно ли имя файла и размер?
- [ ] Установить `enabled: false`, убедиться что upload не происходит и лог чистый
- [ ] Проверить поведение при неверном endpoint (намеренно сломать) — что видит пользователь?

**Чекпоинт:** Все acceptance criteria из spec.md выполнены.

---

## Завершение

- [ ] Self-review: соответствует ли реализация spec.md и design.md?
- [ ] Запусти `/own:done` для проверки по 6 воротам + код-ревью
- [ ] Запусти `/own:retro` для фиксации выводов

## Прогресс

| Фаза | Статус | Начата | Завершена |
|------|--------|--------|-----------|
| Зависимость S3 в Runner | ✅ Завершена | 2026-02-18 | 2026-02-18 |
| Логика загрузки в Run() | ✅ Завершена | 2026-02-18 | 2026-02-18 |
| S3Storage в main | ✅ Завершена | 2026-02-18 | 2026-02-18 |
| Тестирование | ✅ Завершена | 2026-02-18 | 2026-02-18 |

---

*Ты пишешь код. Спрашивай ментора когда застрял.*
